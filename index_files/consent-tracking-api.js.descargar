!function(e){"use strict";const n={TRACKING_ACCEPTED:"trackingConsentAccepted",TRACKING_DECLINED:"trackingConsentDeclined",MARKETING_ACCEPTED:"firstPartyMarketingConsentAccepted",SALE_OF_DATA_ACCEPTED:"thirdPartyMarketingConsentAccepted",ANALYTICS_ACCEPTED:"analyticsConsentAccepted",PREFERENCES_ACCEPTED:"preferencesConsentAccepted",MARKETING_DECLINED:"firstPartyMarketingConsentDeclined",SALE_OF_DATA_DECLINED:"thirdPartyMarketingConsentDeclined",ANALYTICS_DECLINED:"analyticsConsentDeclined",PREFERENCES_DECLINED:"preferencesConsentDeclined",CONSENT_COLLECTED:"visitorConsentCollected",CONSENT_TRACKING_API_LOADED:"consentTrackingApiLoaded"},t="2.1",o={ACCEPTED:"yes",DECLINED:"no",NO_INTERACTION:"no_interaction",NO_VALUE:""},r={NO_VALUE:"",ACCEPTED:"1",DECLINED:"0"},c={GDPR:"GDPR",CCPA:"CCPA",NO_VALUE:""},i={PREFERENCES:"p",ANALYTICS:"a",MARKETING:"m",SALE_OF_DATA:"t"},s={MARKETING:"m",ANALYTICS:"a",PREFERENCES:"p",SALE_OF_DATA:"s"},a={MARKETING:"marketing",ANALYTICS:"analytics",PREFERENCES:"preferences",SALE_OF_DATA:"sale_of_data",EMAIL:"email"},u={HEADLESS_STOREFRONT:"headlessStorefront",ROOT_DOMAIN:"rootDomain",CHECKOUT_ROOT_DOMAIN:"checkoutRootDomain",STOREFRONT_ROOT_DOMAIN:"storefrontRootDomain",STOREFRONT_ACCESS_TOKEN:"storefrontAccessToken",IS_EXTENSION_TOKEN:"isExtensionToken",METAFIELDS:"metafields"},E=["v","con","reg"];function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){A(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function A(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function d(e,n){if(null===e)return"null";if(Array.isArray(e)){const n=e.map((e=>d(e,!0))).join(",");return"[".concat(n,"]")}if("object"==typeof e){let t=[];for(const n in e)e.hasOwnProperty(n)&&void 0!==e[n]&&t.push("".concat(n,":").concat(d(e[n],!0)));const o=t.join(",");return n?"{".concat(o,"}"):o}return"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}function C(e){return function(e){const n=document.cookie?document.cookie.split("; "):[];for(let t=0;t<n.length;t++){const[o,r]=n[t].split("=");if(e===decodeURIComponent(o))return JSON.parse(decodeURIComponent(r))}}(e)}function T(e){return e===encodeURIComponent(decodeURIComponent(e))}function p(e,n,t,o){if(!T(o))throw new TypeError("Cookie value is not correctly URI encoded.");if(!T(e))throw new TypeError("Cookie name is not correctly URI encoded.");let r="".concat(e,"=").concat(o);r+="; path=/",n&&(r+="; domain=".concat(n)),r+="; expires=".concat(new Date((new Date).getTime()+t).toUTCString()),r+="; secure",document.cookie=r}const N="_tracking_consent",O=31536e6;function D(){const e=C(N);if(void 0!==e&&!function(e){if(e.v!==t)return!0;return!function(e,n){const t=n.slice().sort();return e.length===n.length&&e.slice().sort().every(((e,n)=>e===t[n]))}(Object.keys(e).filter((e=>"region"!==e&&"lim"!==e&&"cus"!==e)),E)}(e))return e}function _(){try{let e=D();if(!e)return;return e}catch(e){return}}function g(){return{m:I(s.MARKETING),a:I(s.ANALYTICS),p:I(s.PREFERENCES),s:I(s.SALE_OF_DATA)}}function y(){return g()[s.SALE_OF_DATA]}function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e&&(e=_()),void 0===e}function R(e){switch(e){case r.ACCEPTED:return o.ACCEPTED;case r.DECLINED:return o.DECLINED;default:return o.NO_VALUE}}function h(e){switch(e){case s.ANALYTICS:return a.ANALYTICS;case s.MARKETING:return a.MARKETING;case s.PREFERENCES:return a.PREFERENCES;case s.SALE_OF_DATA:return a.SALE_OF_DATA}}function I(e){const n=_();if(!n)return r.NO_VALUE;const t=n.con.CMP;return t?t[e]:r.NO_VALUE}const w="_cmp_a";function m(){return C(w)}function P(e){const n=m();if(!n)return!0;const t=n.purposes[e];return"boolean"!=typeof t||t}function L(){return P(i.PREFERENCES)}function k(){return P(i.ANALYTICS)}function b(){return P(i.MARKETING)}function v(){return P(i.SALE_OF_DATA)}function M(){const e=m();return!!e&&("boolean"==typeof e.display_banner&&e.display_banner)}function F(){const e=m();return e&&e.sale_of_data_region||!1}function j(e){void 0!==e.granular_consent&&function(e){const t=e[i.MARKETING],o=e[i.SALE_OF_DATA],r=e[i.ANALYTICS],c=e[i.PREFERENCES];!0===t?K(n.MARKETING_ACCEPTED):!1===t&&K(n.MARKETING_DECLINED);!0===o?K(n.SALE_OF_DATA_ACCEPTED):!1===o&&K(n.SALE_OF_DATA_DECLINED);!0===r?K(n.ANALYTICS_ACCEPTED):!1===r&&K(n.ANALYTICS_DECLINED);!0===c?K(n.PREFERENCES_ACCEPTED):!1===c&&K(n.PREFERENCES_DECLINED);const s=function(e){const n={marketingAllowed:e[i.MARKETING],saleOfDataAllowed:e[i.SALE_OF_DATA],analyticsAllowed:e[i.ANALYTICS],preferencesAllowed:e[i.PREFERENCES],firstPartyMarketingAllowed:e[i.MARKETING],thirdPartyMarketingAllowed:e[i.SALE_OF_DATA]};return n}(e);K(n.CONSENT_COLLECTED,s);const a=[r,c,t,o];a.every((e=>!0===e))&&K(n.TRACKING_ACCEPTED);a.every((e=>!1===e))&&K(n.TRACKING_DECLINED)}({[i.PREFERENCES]:L(),[i.ANALYTICS]:k(),[i.MARKETING]:b(),[i.SALE_OF_DATA]:v()})}function K(e,n){document.dispatchEvent(new CustomEvent(e,{detail:n||{}}))}const G=4;function U(e,n){const t=new XMLHttpRequest,o=JSON.stringify(e);function r(o,r){if(t.readyState!==G)return;const c=function(e){try{return JSON.parse(e)}catch(e){return{error:"Unknown error"}}}(t.responseText);var i;0===(i=t.status)||200>=i&&i<400?(j(e),void 0!==n&&n(null,c),o(c)):(void 0!==n&&n(c),r({response:c,code:t.status}))}return t.open("POST","/set_tracking_consent.json",!0),t.setRequestHeader("Content-Type","application/json"),n?(t.onreadystatechange=()=>r((e=>{}),(e=>{})),void t.send(o)):new Promise(((e,n)=>{t.onreadystatechange=()=>r(e,n),t.send(o)}))}function Y(e){const n=d({visitorConsent:f({marketing:e.marketing,analytics:e.analytics,preferences:e.preferences,saleOfData:e.sale_of_data},e.metafields&&{metafields:e.metafields})});return{query:"query { consentManagement { cookies(".concat(n,") { answersCookie trackingConsentCookie } } }"),variables:{}}}function V(e,n){const t=e.granular_consent,o=t.storefrontAccessToken||function(){const e=document.documentElement.querySelector("#shopify-features"),n="Could not find liquid access token";if(!e)return void console.warn(n);const t=JSON.parse(e.textContent||"").accessToken;if(!t)return void console.warn(n);return t}(),r=t.checkoutRootDomain||window.location.host,c=t.isExtensionToken?"Shopify-Storefront-Extension-Token":"x-shopify-storefront-access-token",i={headers:{"content-type":"application/json",[c]:o},body:JSON.stringify(Y(t)),method:"POST"};return fetch("https://".concat(r,"/api/unstable/graphql.json"),i).then((e=>{if(e.ok)return e.json();throw new Error("Server error")})).then((o=>{const r=31536e6,c="."+(t.checkoutRootDomain||window.location.hostname),i="."+(t.storefrontRootDomain||window.location.hostname),s=o.data.consentManagement.cookies.trackingConsentCookie,a=o.data.consentManagement.cookies.answersCookie;return p(N,c,r,s),p(w,c,r,a),i!==c&&(p(N,i,r,s),p(w,i,r,a)),j(e),void 0!==n&&n(null,o),o})).catch((e=>{const t="Error while setting storefront API consent: "+e.message;if(void 0===n)throw{error:t};n({error:t})}))}function B(e,n){if(function(e){if("boolean"!=typeof e&&"object"!=typeof e)throw TypeError("setTrackingConsent must be called with a boolean or object consent value");if("object"==typeof e){const n=Object.keys(e);if(0===n.length)throw TypeError("The submitted consent object is empty.");const t=[a.MARKETING,a.ANALYTICS,a.PREFERENCES,a.SALE_OF_DATA,a.EMAIL,u.ROOT_DOMAIN,u.CHECKOUT_ROOT_DOMAIN,u.STOREFRONT_ROOT_DOMAIN,u.STOREFRONT_ACCESS_TOKEN,u.HEADLESS_STOREFRONT,u.IS_EXTENSION_TOKEN,u.METAFIELDS];for(const e of n)if(!t.includes(e))throw TypeError("The submitted consent object should only contain the following keys: ".concat(t.join(", "),". Extraneous key: ").concat(e,"."))}}(e),void 0!==n&&"function"!=typeof n)throw TypeError("setTrackingConsent must be called with a callback function if the callback argument is provided");let t;if(!0===e||!1===e){console.warn("Binary consent is deprecated. Please update to granular consent (shopify.dev/docs/api/consent-tracking)");t={analytics:e,preferences:e,marketing:e}}else t=e;const o=function(e){if(!e)return null;return z()?document.referrer:""}(t.analytics),r=function(e){if(!e)return null;return z()?window.location.pathname+window.location.search:"/"}(t.analytics);return(t.storefrontAccessToken||t.metafields?V:U)(f(f({granular_consent:t},null!==o&&{referrer:o}),null!==r&&{landing_page:r}),n)}function x(e,n){if(console.warn("This method is deprecated. Please read shopify.dev/docs/api/customer-privacy for the latest information."),"boolean"!=typeof e)throw TypeError("setCCPAConsent must be called with a boolean consent value");if("function"!=typeof n)throw TypeError("setCCPAConsent must be called with a callback function");return U({granular_consent:{sale_of_data:e}},n)}function q(){if(S())return o.NO_VALUE;const e=g();return e[s.MARKETING]===r.ACCEPTED&&e[s.ANALYTICS]===r.ACCEPTED?o.ACCEPTED:e[s.MARKETING]===r.DECLINED||e[s.ANALYTICS]===r.DECLINED?o.DECLINED:o.NO_INTERACTION}function H(){const e=function(){const e=_();return S(e)?c.NO_VALUE:e.reg}();return e in c?e:c.NO_VALUE}function J(){return console.warn("getShopPrefs is deprecated and will be removed."),{limit:[]}}function X(){return function(){const e=_();return S(e)?"":e.region||""}()}function z(){if(""===document.referrer)return!0;const e=document.createElement("a");return e.href=document.referrer,window.location.hostname!=e.hostname}function Q(){return console.warn("isRegulationEnforced is deprecated and will be removed."),!0}function W(){return!!S()||b()&&k()}function Z(){return F()?"string"==typeof navigator.globalPrivacyControl?"1"!==navigator.globalPrivacyControl:"boolean"==typeof navigator.globalPrivacyControl?!navigator.globalPrivacyControl:null:null}function $(){return console.warn("userDataCanBeSold is deprecated and will be replaced with saleOfDataAllowed."),v()}function ee(){return M()&&q()===o.NO_INTERACTION}function ne(){return!1===Z()?o.DECLINED:(e=y(),S()?o.NO_VALUE:e===r.NO_VALUE?o.NO_INTERACTION:R(e));var e}function te(){return console.warn("shouldShowCCPABanner is deprecated and will be removed."),F()&&ne()===o.NO_INTERACTION}function oe(){return!0}function re(e){return function(e){const n=_();if(S(n)||!n.cus)return;const t=n.cus[encodeURIComponent(e)];return t?decodeURIComponent(t):t}(e)}const ce="95ba910bcec4542ef2a0b64cd7ca666c";function ie(e,n,t){try{var o;!function(e){const n=new XMLHttpRequest;n.open("POST","https://notify.bugsnag.com/",!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Bugsnag-Api-Key",ce),n.setRequestHeader("Bugsnag-Payload-Version","5");const t=function(e){const n=function(e){return e.stackTrace||e.stack||e.description||e.name}(e.error),[t,o]=(n||"unknown error").split("\n")[0].split(":");return JSON.stringify({payloadVersion:5,notifier:{name:"ConsentTrackingAPI",version:"latest",url:"-"},events:[{exceptions:[{errorClass:(t||"").trim(),message:(o||"").trim(),stacktrace:[{file:"consent-tracking-api.js",lineNumber:"1",method:n}],type:"browserjs"}],context:e.context||"general",app:{id:"ConsentTrackingAPI",version:"latest"},metaData:{request:{shopId:e.shopId,shopUrl:window.location.href},device:{userAgent:window.navigator.userAgent},"Additional Notes":e.notes},unhandled:!1}]})}(e);n.send(t)}({error:e,context:n,shopId:ae()||(null===(o=window.Shopify)||void 0===o?void 0:o.shop),notes:t})}catch(e){}}function se(e){return function(){try{return e(...arguments)}catch(e){throw ie(e),e}}}function ae(){try{const e=document.getElementById("shopify-features").textContent;return JSON.parse(e).shopId}catch(e){return null}}function ue(){return b()}function Ee(){return v()}function le(){const e={},n=g();for(const t of Object.keys(n))e[h(t)]=R(n[t]);return e}function fe(e,n){return"object"==typeof e&&e.headlessStorefront&&!e.storefrontAccessToken?(console.warn("Headless consent has been updated. Please read shopify.dev/docs/api/customer-privacy to integrate."),function(e,n){function o(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.NO_VALUE;return!0===e?r.ACCEPTED:!1===e?r.DECLINED:n}const i={[s.ANALYTICS]:o(e[a.ANALYTICS],r.DECLINED),[s.MARKETING]:o(e[a.MARKETING],r.DECLINED),[s.PREFERENCES]:o(e[a.PREFERENCES],r.DECLINED),[s.SALE_OF_DATA]:o(e[a.SALE_OF_DATA])},u={v:t,reg:c.NO_VALUE,con:{CMP:i}},E=encodeURIComponent(JSON.stringify(u));return p(N,e.rootDomain,O,E),n(null),new Promise(((e,n)=>{}))}(e,n||(()=>{}))):B(e,n)}const Ae=e=>{let{useBugsnagReporting:n}=e;y()!=r.DECLINED&&!1===Z()&&x(!1,(()=>!1));const t={getTrackingConsent:q,setTrackingConsent:fe,userCanBeTracked:W,getRegulation:H,isRegulationEnforced:Q,getShopPrefs:J,shouldShowGDPRBanner:ee,userDataCanBeSold:$,setCCPAConsent:x,getCCPAConsent:ne,shouldShowCCPABanner:te,doesMerchantSupportGranularConsent:oe,analyticsProcessingAllowed:k,preferencesProcessingAllowed:L,marketingAllowed:ue,firstPartyMarketingAllowed:ue,saleOfDataAllowed:Ee,thirdPartyMarketingAllowed:Ee,currentVisitorConsent:le,shouldShowBanner:M,saleOfDataRegion:F,getRegion:X,getTrackingConsentMetafield:re,unstable:{analyticsProcessingAllowed:k,preferencesProcessingAllowed:L,marketingAllowed:ue,saleOfDataAllowed:Ee,currentVisitorConsent:le,shouldShowBanner:M,saleOfDataRegion:F}};if(!n)return t;const o=["unstable"];for(const e in t)t.hasOwnProperty(e)&&(t[e]=o.includes(e)?t[e]:se(t[e]));return t};function de(){return Ae(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{useBugsnagReporting:!1})}function Ce(){window.Shopify.customerPrivacy=window.Shopify.trackingConsent=de({useBugsnagReporting:!0}),K(n.CONSENT_TRACKING_API_LOADED)}window.Shopify=window.Shopify?window.Shopify:{},Ce(),e.default=de,e.setGlobalObject=Ce,Object.defineProperty(e,"__esModule",{value:!0})}({});
//# sourceMappingURL=consent-tracking-api.js.map
